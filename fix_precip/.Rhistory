#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat, (seq_along(yr.dat)-1) %/% (6*time.stat), mean)/(1/time.stat)/(60*60)
print(mean(yr.6hr[200:350][which(yr.6hr[200:350]>0)],na.rm=TRUE))
print(mean(yr.6hr[1:199][which(yr.6hr[1:199]>0)],na.rm=TRUE))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
print("Winter: ",mean(yr.6hr[200:350][which(yr.6hr[200:350]>0)],na.rm=TRUE))
print(paste("Winter: ",mean(yr.6hr[200:350][which(yr.6hr[200:350]>0)],na.rm=TRUE,sep=""))
)
print(paste("Winter: ",mean(yr.6hr[200:350][which(yr.6hr[200:350]>0)],na.rm=TRUE),sep=""))
print(paste("Summer: ",mean(yr.6hr[1:199][which(yr.6hr[1:199]>0)],na.rm=TRUE),sep=""))
print(paste("Summer: ",mean(yr.6hr[200:350][which(yr.6hr[200:350]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:199][which(yr.6hr[1:199]>0)],na.rm=TRUE),sep=""))
min.6hr <- max.6hr <- med.6hr <- low.6hr <- list()
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat, (seq_along(yr.dat)-1) %/% (6*time.stat), mean)/(1/time.stat)/(60*60)
print(paste("Summer: ",mean(yr.6hr[200:350][which(yr.6hr[200:350]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:199][which(yr.6hr[1:199]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
min.6hr <- max.6hr <- med.6hr <- low.6hr <- list()
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat, (seq_along(yr.dat)-1) %/% (6*time.stat), mean)/(1/time.stat)/(60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
install.packages("rnoaa",loc="/usr4/spclpgm/jmatthes/")
install.packages("rnoaa",lib="/usr4/spclpgm/jmatthes/")
install.packages("httr",lib="/usr4/spclpgm/jmatthes/")
library("rnoaa",lib.loc="/usr4/spclpgm/jmatthes/")
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(1/time.stat), (seq_along(yr.dat)-1) %/% (6*time.stat), sum)/(60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(1/time.stat), (seq_along(yr.dat)-1) %/% (6*time.stat), mean)/(60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
min.6hr <- max.6hr <- med.6hr <- low.6hr <- list()
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(1/time.stat), (seq_along(yr.dat)-1) %/% (6*time.stat), sum)/(6*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
min.6hr <- max.6hr <- med.6hr <- low.6hr <- list()
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(1/time.stat), (seq_along(yr.dat)-1) %/% (6*time.stat), sum)/((6*time.stat)*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
min.6hr <- max.6hr <- med.6hr <- low.6hr <- list()
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(1/time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(time.stat), (seq_along(yr.dat)-1) %/% (6*time.stat), sum)/(6*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*6),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
f
y
window.avg <- 24
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(time.stat), (seq_along(yr.dat)-1) %/% (window.avg*time.stat), sum)/(window.avg*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*window.avg),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*6),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
min.6hr <- max.6hr <- med.6hr <- low.6hr <- list()
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(time.stat), (seq_along(yr.dat)-1) %/% (window.avg*time.stat), sum)/(window.avg*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*window.avg),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*window.avg),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(time.stat), (seq_along(yr.dat)-1) %/% (window.avg*time.stat), sum)/(window.avg*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*window.avg),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,100,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*window.avg),na.rm=TRUE)),xlim=c(0,10))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(time.stat), (seq_along(yr.dat)-1) %/% (window.avg*time.stat), sum)/(window.avg*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*window.avg),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,100,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*window.avg),na.rm=TRUE)),xlim=c(0,100))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
hist(yr.6hr[yr.6hr>0]*(60*60*window.avg),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,100,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*window.avg),na.rm=TRUE)),xlim=c(0,100))
for(f in 1:length(af.file)){
dat <- read.csv(paste(af.path,af.file[f],sep=""),header=TRUE)
dat[dat==-9999] <- NA
#figure out if data are hourly/half-hourly
time.check <- diff(dat[dat[,1]>=2007 & dat[,1]<2008,1])*365
if(time.check[1]*24>0.9){ #if hourly
time.stat <- 1
} else if(time.check[1]*24<0.9){ #if half-hourly
time.stat <- 2
} else{
print("Warning! Ameriflux time is weird.")
}
#calculate annual precip distirbution
af.yrs <- unique(floor(dat[,1]))
min.6hr[[f]] <- max.6hr[[f]] <- low.6hr[[f]] <- med.6hr[[f]] <- vector(length=length(af.yrs))
for(y in af.yrs){
yr.dat <- dat[which(floor(dat[,1])==y),2]
if(length(yr.dat)>1){
#mean 6-hourly precip: mm/(time.stat) = mm/hr --> mm/s
yr.6hr <- tapply(yr.dat/(time.stat), (seq_along(yr.dat)-1) %/% (window.avg*time.stat), sum)/(window.avg*60*60)
print(paste("Summer: ",mean(yr.6hr[200:300][which(yr.6hr[200:300]>0)],na.rm=TRUE),sep=""))
print(paste("Winter: ",mean(yr.6hr[1:100][which(yr.6hr[1:100]>0)],na.rm=TRUE),sep=""))
if(sum(!is.na(yr.6hr))>1){
hist(yr.6hr[yr.6hr>0]*(60*60*window.avg),main=paste(sites[f],": ",y,sep=""),
xlab="Precip [mm/6hr]",ylab="density",breaks=c(seq(0,20,by=0.5),
max(yr.6hr[yr.6hr>0]*(60*60*window.avg),na.rm=TRUE)),xlim=c(0,100))
}
min.6hr[[f]][y-min(af.yrs)+1] <- min(yr.6hr[yr.6hr>0],na.rm=TRUE)
max.6hr[[f]][y-min(af.yrs)+1] <- max(yr.6hr[yr.6hr>0],na.rm=TRUE)
med.6hr[[f]][y-min(af.yrs)+1] <- median(yr.6hr[yr.6hr>0],na.rm=TRUE)
low.6hr[[f]][y-min(af.yrs)+1] <- quantile(yr.6hr[yr.6hr>0], 0.05, na.rm = TRUE)
} else{
min.6hr[[f]][y-min(af.yrs)+1] <- NA
max.6hr[[f]][y-min(af.yrs)+1] <- NA
med.6hr[[f]][y-min(af.yrs)+1] <- NA
low.6hr[[f]][y-min(af.yrs)+1] <- NA
}
}
}
